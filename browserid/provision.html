<html>
  <head>
    <script src="https://login.persona.org/provisioning_api.js"></script>
    <script src="../js/jquery-1.10.2.min.js"></script>
  </head>
  <body>
    <script>
      function generateServerSide(email, pubkey, certDur, callback) {
        var data = JSON.stringify({
          duration : certDur,
          pubkey : pubkey,
          email : email
        });

        $.ajax( {
          url: 'https://ryanseys.com/certify',
          type: 'post',
          data: data,
          headers: {
            "Content-Type": 'application/json; charset=utf-8'  //for object property name, use quoted notation shown in second
          },
          dataType: "json",
          success: function(returndata)
          {
            if(returndata.success)
              return callback(returndata.certificate);
            return callback(null);
          }
        });
      }

      navigator.id.beginProvisioning(function(email, certDuration) {
        navigator.id.genKeyPair(function(publicKey) {
          generateServerSide(email, publicKey, certDuration, function (certificate) {
            // generateServerSide something you would write.
            // In this example, imagine it does an AJAX request to create a certificate,
            // and then invokes a callback with that certificate.
            navigator.id.registerCertificate(certificate);
          });
        });
      });
    </script>
    <p>Provision.html</p>
  </body>
</html>
