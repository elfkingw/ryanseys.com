<html>
  <head>
    <script src="https://login.persona.org/provisioning_api.js"></script>
    <script src="../js/jquery-1.10.2.min.js"></script>
  </head>
  <body>
    <script>
      function generateServerSide(email, pubkey, certDur, callback) {
        var data = {};
        alert(email);
        alert(pubkey);
        alert(certDur);
        data.duration = certDur;
        data.pubkey = JSON.stringify(pubkey);
        data.email = email;
        $.post("/certify", data)
        .done(function(returndata) {

        });

        $.ajax( {
          url: 'https://ryanseys.com/certify',
          type: 'post',
          data: data,
          headers: {
            "Content-Type": 'application/json'  //for object property name, use quoted notation shown in second
          },
          dataType: 'json',
          success: function(returndata)
          {
            var cert;
            if(typeof(returndata) == "string")
              cert = JSON.parse(returndata).certificate;
            else cert = returndata.certificate;
            alert(cert);
            callback(cert);
          }
        });
      }

      navigator.id.beginProvisioning(function(email, certDuration) {
        alert(email);
        navigator.id.genKeyPair(function(publicKey) {
          generateServerSide(email, publicKey, certDuration, function (certificate) {
            // generateServerSide something you would write.
            // In this example, imagine it does an AJAX request to create a certificate,
            // and then invokes a callback with that certificate.
            navigator.id.registerCertificate(certificate);
          });
        });
      });
    </script>
    <p>Provision.html</p>
  </body>
</html>
