<html>
  <head>
    <script src="https://login.persona.org/authentication_api.js"></script>
  </head>
  <body>
    <script>
    function getAccessToken() {
      try {
        return location.href.match(/access_token=(\S*)&/)[1];
      }
      catch(err) {
        return null;
      }
    }

    var token = getAccessToken();

    if(token) {
      alert("got token! " + token);
      // get email from this fb login
    }
    else {
      location.href="https://www.facebook.com/dialog/oauth?display=popup&response_type=token&scope=email&client_id=359821740813622&redirect_uri=https://ryanseys.com/browserid/sign_in.html?";
    }

    var loggedIn = false;
    var cancelButton = document.getElementById('cancelButton');
    cancelButton.onclick = function() {  };

    navigator.id.beginAuthentication(function(email) {
      //try to login to fb with this email
      if(loggedIn) {
        navigator.id.completeAuthentication();
      }
      else {
        navigator.id.raiseAuthenticationFailure('not logged in')
        // if fail, then show login
      }
    });
    </script>
  </body>
</html>
